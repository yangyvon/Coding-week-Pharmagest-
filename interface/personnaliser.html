<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>OffiBoard - Personnaliser</title>
		<link href="dropdown-menu.css" media="screen" rel="stylesheet" type="text/css" />
		
		<!-- Bootstraps -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
		<!-- AngularJS -->
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
		<script src="https://cdn.gitcdn.link/cdn/angular/bower-material/v1.1.5/angular-material.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

		<!-- ng-table -->
		<link rel="stylesheet" href="http://cdn.jsdelivr.net/angular.ngtable/0.3.2/ng-table.css">
        <script src="http://cdn.jsdelivr.net/angular.ngtable/0.3.2/ng-table.js"></script>

         <!-- ChartJS-->
        <script src=https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js></script>
        		
		<!-- Dates en français -->
		<script src="angular-locale_fr-fr.js"></script>
		
		<link rel="stylesheet" href="styleDSQ.css" />
		<script data-require="angular.js@1.0.x" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js" data-semver="1.0.8"></script>
		<script> 
			var app = angular.module('TestUploadFile', ["ngTable"]);
		</script>

		<script src="upload.js"></script>
		<script src="app.js"></script>
	</head>

	<body ng-app="TestUploadFile" ng-controller="JsonUploadController">

		<ul id="navigation" class="nav-main">
			<li class="offiTitle">OffiBoard</li>
			<li><a href="accueil.html">Accueil</a></li>
			<li><a href="#">Ventes</a></li>
			<li><a href="#">Achats</a></li>
			<li><a href="#">Clients</a></li>
			<li><a href="#">Collectivités</a></li>
			<li><a href="#">Opérateurs</a></li>
			<li><a href="#">Produits</a></li>
			<li><a href="personnaliser.html">Personnaliser</a></li>
		</ul>
		
		<div class="container">
			<p style="float: right;">Le {{ clock | date:"EEEE dd MMMM yyyy"}} à {{ clock | date:"HH:mm:ss"}}</p>
		</div>

		<br>
		<span><center><h3><font face="verdana">Liste des Widgets</font></h3></center></span>

		<div id="flexDisplay2">
			
			<div ng-repeat="widget in listWidgets">
				<b>Nom : </b>{{widget.nomWidget}}
				<br>
				<b>Section : </b>{{widget.sectionWidget}}
				<br><br>
				<button type="button"
						ng-click="openWidget(widget.nomWidget, widget.nbCol, widget.idCol, widget.Axes, widget.nbLignes, widget.jsonFile, widget.sectionWidget, widget.jsonName)"
						data-toggle="modal"
						data-target="#Modifier">
					Ouvrir Widget
				</button>
				<br><br><br>
			</div>
		</div>

		<div id="droit">
			<ul>
				<a href="#"><button type="button"  data-toggle="modal" data-target="#Ajout">Ajouter</button></a>
				<!--<a href="#"><button type="button" data-toggle="modal" data-target="#Modifier">Modifier</button></a>
				-->
				<a href="#"><button type="button" data-toggle="modal" data-target="#Supprimer">Supprimer</button></a>
				<select ng-model="sectionWidget" ng-init="sectionWidget = listeSection[0]" ng-options="option for option in listeSection">
				</select>
			</ul>
		</div>

		<!-- Modal

			Ajouter un widget

		-->
		<div class="modal fade" id="Ajout" role="dialog" style="width:100%;">
		
			<div class="modal-dialog" style="width:100%; height:575px;">

				<!-- Modal content-->
				<div class="modal-content" style="width:100%; height:575px;">
				
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" ng-click="closeWidget()">&times;</button>
						<h4 class="modal-title">Ajouter un Widget</h4>
					</div>
					
					<div class="modal-body" style="width:100%;">
					
						<form>
							<div id="flexDisplay">
									
								<div id="conteneur" style="margin: 0;">
										
									<div class="col-md-8">
											
										<form method="POST" enctype="multipart/form-data">
											<input id="selectedFile" type="file" ng-model="selectedJson" read-text="onFileSelect($files)" style="display: none;">
											<input type="button" value="Choix du JSON" onclick="document.getElementById('selectedFile').click();"/>
											<span>Json sélectionné : {{jsonFileName}}</span>
										</form>
										<br>
										<i ng-hide="jsonSrc">Aucun json sélectionné</i>
										
										<span ng-show="jsonSrc"><b>Nom du Widget :</b></span>
										<input ng-show="jsonSrc" ng-model="widgetName" type="text" placeholder="">
										<br>
									
										<span ng-show="jsonSrc"><b>Section du Widget :</b></span>
										<select ng-show="jsonSrc" ng-model="sectionWidget" ng-init="sectionWidget = listeSection[0]" ng-options="option for option in listeSection">
										</select>
											
										<br>
											
										<span><b ng-show="jsonSrc">Choisir le premier axe :</b></span> 
										<select ng-show="jsonSrc" ng-model="selecteds[0]" ng-options="keys.indexOf(key) as key for key in keys">
										</select>
										<!-- <span ng-show="types[selecteds[0]]"> Type du premier axe : {{types[selecteds[0]]}}</span> -->
												
										<br>
												
										<span><b ng-show="jsonSrc">Choisir le second axe :</b></span> 
										<select ng-show="jsonSrc" ng-model="selecteds[1]" ng-options="keys.indexOf(key2) as key2 for key2 in keys">
										</select>
										
										<!-- <span ng-show="types[selecteds[1]]">Type du second axe : {{types[selecteds[1]]}}</span> -->
										
										<br>
										
										<span ng-show="jsonSrc"><b>Axes supplémentaires<br>(5 maximum) :</b><br><br></span>
										
										<addbuttonsbutton></addbuttonsbutton>
										
										<br><br>
										
										<div ng-switch on="colCount>=3">
											<select id='divselecteds[2]' ng-switch-when="true" ng-model='selecteds[2]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=4">
											<select id='divselecteds[3]' ng-switch-when="true" ng-model='selecteds[3]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=5">
											<select id='divselecteds[4]' ng-switch-when="true" ng-model='selecteds[4]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=6">
											<select id='divselecteds[5]' ng-switch-when="true" ng-model='selecteds[5]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=7">
											<select id='divselecteds[6]' ng-switch-when="true" ng-model='selecteds[6]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<br>
										<center><button ng-show="jsonSrc" class="btn btn-success" ng-click="widgetAdd(widgetName, colCount, uniqId, selecteds, display_limit1, jsonSrc, sectionWidget, jsonFileName)" data-dismiss="modal">
											Sauvegarder Widget
										</button></center>

									</div>
												
								</div>

								<div id="conteneur">
									<div ng-show="types[selecteds[0]]=='date' && selecteds[1] ">
										Fonction somme par mois : 
										<input type="text" placeholder="Choisissez l'année" ng-model="selectedYear">
										<button ng-click="afficherGrapheTableau()" ng-bind="labelButtonGraphtoTable"></button>
										<br>
										<div ng-show="selectedYear">
											<span>{{keys[selecteds[1]].toString()}} par mois en {{selectedYear}} :</span>
											<br><br>
											<canvas id="Chart">
												{{getChart(keys[selectedX].toString(),keys[selectedY].toString(),selectedYear)}}
											</canvas>
											<table>
												<tr>
													<th>Mois</th><th>{{keys[selecteds[1]]}}</th>
												</tr>
												<tr ng-repeat="CA in sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)">
													<td>{{ getMonthsNames()[$index] }}</td>
													<td >{{ sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)[$index] }}</td>
												</tr>
											</table>
										</div>
									</div>
								</div>
										
								<div id="conteneur" ng-show="keys[selecteds[0]] && keys[selecteds[1]]">
										
									<div>
										Lignes affichées (total : {{getValues(keys[0]).length}}) :
										<input ng-model="display_limit1" type="text" size="5">
												
										<br><br>
										
										<!--
										<pre>Sort by = {{propertyName}}; reverse = {{reverse}}</pre>
										<hr/>
										<button ng-click="propertyName = null; reverse = false">Set to unsorted</button>
										<hr/>
										<br><br>
										-->
											
										<table class="table table-bordered table-condensed table-striped">
												
												<tbody>
													<tr>
														<td colspan="{{colCount}}">
															<div class="scrollit">
																<table class="friends">
																	<tr>
																		<th ng-repeat="sel in selecteds | limitTo: colCount" width="200">
																			<button ng-click="sortBy(keys[sel])">{{keys[sel]}}</button>
																			<span class="sortorder" ng-show="propertyName == keys[sel]" ng-class="{reverse: reverse}"></span>
																		</th>
																	</tr>
																	<tr ng-repeat="value in lignes | orderBy:propertyName:reverse | limitTo:display_limit1" ng-init="parentIndex = $index">
																		<td ng-repeat="sel in selecteds | limitTo: colCount" width="200">
																			{{getValues(keys[sel])[parentIndex]}}
																		</td>  
																	</tr>
																</table>
															</div>
														</td>
													</tr>
												</tbody>
												
												<!--
												<tbody>
													<tr>
														<td colspan="{{colCount}}">
															<div class="scrollit">
																<table>
																	<tr>
																		<th ng-repeat="sel in selecteds | limitTo: colCount" width="200">{{keys[sel]}}
																		<button ng-click="sortBy(propertyName)">{{keys[sel]}}</button>

																		</th>
																	</tr>
																	<tr ng-repeat="value in lignes | orderBy: propertyName :reverse |limitTo:display_limit1" ng-init="parentIndex = $index">
																		<td ng-repeat="sel in selecteds |  limitTo: colCount" width="200">
																			{{ getValues(keys[sel])[parentIndex] }}

																		</td>  
																	</tr>
																</table>
															</div>
														</td>
													</tr>
												</tbody>
												-->
										</table>
									</div>
								</div>
							</div>
						</form>

					</div>
				</div>
			</div>
		</div>


		<!-- Modal

			modifier un widget

		-->
		<div class="modal fade" id="Modifier" role="dialog" style="width:100%;">

			<div class="modal-dialog" style="width:100%; height:575px;">

				<!-- Modal content-->
				<div class="modal-content" style="width:100%; height:575px;">

					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" ng-click="closeWidget()">&times;</button>
						<h4 class="modal-title">Modifier un Widget</h4>
					</div>

					<div class="modal-body" style="width:100%;">

						<form>
							<div id="flexDisplay">

								<div id="conteneur" style="margin: 0;">

									<div class="col-md-8">

										<form>
											<input id="selectedFile" type="file" ng-model="selectedJson" read-text="onFileSelect($files)" style="display: none;">
											<input type="button" value="Choix du JSON" onclick="document.getElementById('selectedFile').click();"/>
											<span>Json sélectionné : {{jsonFileName}}</span>
										</form>
										<br>
										<i ng-hide="jsonSrc">Aucun json sélectionné</i>

										<span ng-show="jsonSrc"><b>Nom du Widget :</b></span>
										<input ng-show="jsonSrc" ng-model="widgetName" type="text" placeholder="">
										<br>

										<span ng-show="jsonSrc"><b>Section du Widget :</b></span>
										<select ng-show="jsonSrc" ng-model="sectionWidget" ng-init="sectionWidget = listeSection[0]" ng-options="option for option in listeSection">
										</select>

										<br>

										<span><b ng-show="jsonSrc">Choisir le premier axe :</b></span>
										<select ng-show="jsonSrc" ng-model="selecteds[0]" ng-options="keys.indexOf(key) as key for key in keys">
										</select>
										<!-- <span ng-show="types[selecteds[0]]"> Type du premier axe : {{types[selecteds[0]]}}</span> -->

										<br>

										<span><b ng-show="jsonSrc">Choisir le second axe :</b></span>
										<select ng-show="jsonSrc" ng-model="selecteds[1]" ng-options="keys.indexOf(key2) as key2 for key2 in keys">
										</select>

										<!-- <span ng-show="types[selecteds[1]]">Type du second axe : {{types[selecteds[1]]}}</span> -->

										<br>

										<span ng-show="jsonSrc"><b>Axes supplémentaires<br>(5 maximum) :</b><br><br></span>

										<addbuttonsbutton></addbuttonsbutton>

										<br><br>

										<div ng-switch on="colCount>=3">
											<select id='divselecteds[2]' ng-switch-when="true" ng-model='selecteds[2]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>

										<div ng-switch on="colCount>=4">
											<select id='divselecteds[3]' ng-switch-when="true" ng-model='selecteds[3]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>

										<div ng-switch on="colCount>=5">
											<select id='divselecteds[4]' ng-switch-when="true" ng-model='selecteds[4]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>

										<div ng-switch on="colCount>=6">
											<select id='divselecteds[5]' ng-switch-when="true" ng-model='selecteds[5]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>

										<div ng-switch on="colCount>=7">
											<select id='divselecteds[6]' ng-switch-when="true" ng-model='selecteds[6]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>

										<br>
										<center><button ng-show="jsonSrc" class="btn btn-success" ng-click="widgetAdd(widgetName, colCount, uniqId, selecteds, display_limit1, jsonSrc, sectionWidget, jsonFileName)" data-dismiss="modal">
											Sauvegarder Widget
										</button></center>

									</div>

								</div>

								<div id="conteneur">
									<div ng-show="types[selecteds[0]]=='date' && selecteds[1] ">
										Fonction somme par mois :
										<input type="text" placeholder="Choisissez l'année" ng-model="selectedYear">
										<br>
										<div ng-show="selectedYear">
											<span>{{keys[selecteds[1]].toString()}} par mois en {{selectedYear}} :</span>
											<br><br>
											<table>
												<tr>
													<th>Mois</th><th>{{keys[selecteds[1]]}}</th>
												</tr>
												<tr ng-repeat="CA in sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)">
													<td>{{ getMonthsNames()[$index] }}</td>
													<td >{{ sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)[$index] }}</td>
												</tr>
											</table>
										</div>
									</div>
								</div>

								<div id="conteneur" ng-show="keys[selecteds[0]] && keys[selecteds[1]]">

									<div>
										Lignes affichées (total : {{getValues(keys[0]).length}}) :
										<input ng-model="display_limit1" type="text" size="5">

										<br><br>

										<table class="table table-bordered table-condensed table-striped">
											<tbody>
											<tr>
												<td colspan="{{colCount}}">
													<div class="scrollit">
														<table>
															<tr>
																<th ng-repeat="sel in selecteds | limitTo: colCount" width="200">{{keys[sel]}}</th>
															</tr>
															<tr ng-repeat="value in getValues(keys[0]) | limitTo:display_limit1" ng-init="parentIndex = $index">
																<td ng-repeat="sel in selecteds | limitTo: colCount" width="200">
																	{{ getValues(keys[sel])[parentIndex] }}
																</td>
															</tr>
														</table>
													</div>
												</td>
											</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</form>

					</div>
				</div>
			</div>
		</div>


		<!-- Modal
		<div class="modal fade" id="Modifier" role="dialog">
		
			<div class="modal-dialog">


				<div class="modal-content">
				
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Modifier un Widget</h4>
					</div>
					
					<div class="modal-body">

						<form role="form">


							<p>Choisir le Widget à modifier：</p>
								
							<select>
								<option value ="graphe1">Widget 1 </option>
								<option value ="graphe2">Widget 2</option>
								<option value="graphe3">Widget 3</option>
								<option value="graphe4">Widget 4</option>
							</select>
							
							<p>Axe</p>

							<p><button ng-click="todoAdd()">Ajouter</button></p>

							<br>

							<div ng-repeat="x in todoList">
								<input type="checkbox" ng-model="x.done"> <span ng-bind="x.todoText"></span>
							</div>

							<p><button ng-click="remove()">Supprimer</button></p>
							<p>Modifier le type de graphe</p>
							<select>
								<option value ="Camembert">Camembert </option>
								<option value ="Histogramme">Histogramme</option>
								<option value="Diagramme">Diagramme en bâtons</option>
								<option value="Nuage">Nuage de points</option>
							</select>

							<p>Graphes proposés</p>
							<select>
								<option value ="Camembert">Camembert </option>
								<option value ="Histogramme">Histogramme</option>
								<option value="Diagramme">Diagramme en bâtons</option>
								<option value="Nuage">Nuage de points</option>
							</select>

							<p>Choisir la section du graphe</p>
							<select>
								<option value ="Ventes">Ventes </option>
								<option value ="Achats">Achats</option>
								<option value="Clients">Clients</option>
								<option value="Collectivites">Collectivités</option>
								<option value="Operateurs">Opérateurs</option>
								<option value="Produits">Produits</option>
							</select>
							
							<button type="submit" class="btn btn-success btn-block">Modifier</button>

						</form>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Quitter</button>
					</div>
				</div>
			</div>
		</div>
		-->



		<!-- Modal

		 	Supprimer

		 -->
		<div class="modal fade" id="Supprimer" role="dialog">
		
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
				
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Supprimer un Widget</h4>
					</div>
					
					<div class="modal-body">

						<form role="form" action="#">

							<p>Choisir les Widgets à supprimer :</p>
							<table border="1">
								<tr>
									<td>Liste des Widgets</td>
									<td>Supprimer</td>
								</tr>
								<tr ng-repeat="widget in listWidgets">
									<td>
										<b>Nom : </b>{{widget.nomWidget}}
										<br>
										<b>Section : </b>{{widget.sectionWidget}}
									</td>
									<td><input type="checkbox" ng-click="checkBoxClick($index)"/></td>
								</tr>
							</table>

						</form>
					</div>
					
					<div class="modal-footer">
						<button class="btn btn-success" ng-click="widgetDelete()" data-dismiss="modal">Supprimer</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Quitter</button>
					</div>
				</div>
			</div>
		</div>

	</body>
		
</html>