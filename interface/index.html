<!DOCTYPE html>
<html ng-app="TestUploadFile">

	<head>
		<!-- Encodage -->
		<meta charset="utf-8" />
		
		<!-- Feuille de style -->
		<link rel="stylesheet" type="text/css" href="styleDSQ.css">
		
		<!-- Bootstrap -->
		<link data-require="bootstrap-css@3.0.0-rc2" data-semver="3.0.0-rc2" rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap.min.css" />
		
		<!-- AngularJS -->
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
		<script src="https://cdn.gitcdn.link/cdn/angular/bower-material/v1.1.5/angular-material.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

		<!-- ng-table -->
		<link rel="stylesheet" href="http://cdn.jsdelivr.net/angular.ngtable/0.3.2/ng-table.css">
        <script src="http://cdn.jsdelivr.net/angular.ngtable/0.3.2/ng-table.js"></script>

		<title>OffiBoard</title>
		<script>document.write('<base href="' + document.location + '" />');</script>
		<link rel="stylesheet" href="styleDSQ.css" />
		<script data-require="angular.js@1.0.x" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js" data-semver="1.0.8"></script>
		<script> 
			var app = angular.module('TestUploadFile', ["ngTable"]);
		</script>

		<script src="upload.js"></script>
		<script src="app.js"></script>
	</head>

	<body>
 
		<div ng-controller="JsonUploadController" class="container">
			
			<div id="flexDisplay">
									
								<div id="conteneur" style="margin: 0;">
										
									<div class="col-md-8">
											
										<form>
											<input id="selectedFile" type="file" ng-model="selectedJson" read-text="onFileSelect($files)" style="display: none;">
											<input type="button" value="Choix du JSON" onclick="document.getElementById('selectedFile').click();"/>
											<span>Json sélectionné : {{jsonFileName}}</span>
										</form>
										<br>
										<i ng-hide="jsonSrc">Aucun json sélectionné</i>
										
										<span ng-show="jsonSrc"><b>Nom du Widget :</b></span>
										<input ng-show="jsonSrc" ng-model="widgetName" type="text" placeholder="">
										<br>
									
										<span ng-show="jsonSrc"><b>Section du Widget :</b></span>
										<select ng-show="jsonSrc" ng-model="sectionWidget" ng-init="sectionWidget = listeSection[0]" ng-options="option for option in listeSection">
										</select>
											
										<br>
											
										<span><b ng-show="jsonSrc">Choisir le premier axe :</b></span> 
										<select ng-show="jsonSrc" ng-model="selecteds[0]" ng-options="keys.indexOf(key) as key for key in keys">
										</select>
										<!-- <span ng-show="types[selecteds[0]]"> Type du premier axe : {{types[selecteds[0]]}}</span> -->
												
										<br>
												
										<span><b ng-show="jsonSrc">Choisir le second axe :</b></span> 
										<select ng-show="jsonSrc" ng-model="selecteds[1]" ng-options="keys.indexOf(key2) as key2 for key2 in keys">
										</select>
										
										<!-- <span ng-show="types[selecteds[1]]">Type du second axe : {{types[selecteds[1]]}}</span> -->
										
										<br>
										
										<span ng-show="jsonSrc"><b>Axes supplémentaires<br>(5 maximum) :</b><br><br></span>
										
										<addbuttonsbutton></addbuttonsbutton>
										
										<br><br>
										
										<div ng-switch on="colCount>=3">
											<select id='divselecteds[2]' ng-switch-when="true" ng-model='selecteds[2]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=4">
											<select id='divselecteds[3]' ng-switch-when="true" ng-model='selecteds[3]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=5">
											<select id='divselecteds[4]' ng-switch-when="true" ng-model='selecteds[4]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=6">
											<select id='divselecteds[5]' ng-switch-when="true" ng-model='selecteds[5]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<div ng-switch on="colCount>=7">
											<select id='divselecteds[6]' ng-switch-when="true" ng-model='selecteds[6]' ng-options='keys.indexOf(key) as key for key in keys'></select>
										</div>
										
										<br>
										<center><button ng-show="jsonSrc" class="btn btn-success" ng-click="widgetAdd(widgetName, colCount, uniqId, selecteds, display_limit1, jsonSrc, sectionWidget, jsonFileName)" data-dismiss="modal">
											Sauvegarder Widget
										</button></center>

									</div>
												
								</div>

								<div id="conteneur">
									<div ng-show="types[selecteds[0]]=='date' && selecteds[1] ">
										Fonction somme par mois : 
										<input type="text" placeholder="Choisissez l'année" ng-model="selectedYear">
										<button ng-click="afficherGrapheTableau()" ng-bind="labelButtonGraphtoTable"></button>
										<br>
										<div ng-show="selectedYear">
											<span>{{keys[selecteds[1]].toString()}} par mois en {{selectedYear}} :</span>
											<br><br>
											<canvas id="Chart">
												{{getChart(keys[selectedX].toString(),keys[selectedY].toString(),selectedYear)}}
											</canvas>
											<table>
												<tr>
													<th>Mois</th><th>{{keys[selecteds[1]]}}</th>
												</tr>
												<tr ng-repeat="CA in sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)">
													<td>{{ getMonthsNames()[$index] }}</td>
													<td >{{ sumValuesByMonth(keys[selecteds[0]].toString(),keys[selecteds[1]].toString(),selectedYear)[$index] }}</td>
												</tr>
											</table>
										</div>
									</div>
								</div>
										
								<div id="conteneur" ng-show="keys[selecteds[0]] && keys[selecteds[1]]">
										
									<div>
										Lignes affichées (total : {{getValues(keys[0]).length}}) :
										<input ng-model="display_limit1" type="text" size="5">
												
										<br><br>
										
										<!--
										<pre>Sort by = {{propertyName}}; reverse = {{reverse}}</pre>
										<hr/>
										<button ng-click="propertyName = null; reverse = false">Set to unsorted</button>
										<hr/>
										<br><br>
										-->
											
										<table class="table table-bordered table-condensed table-striped">
												
												<tbody>
													<tr>
														<td colspan="{{colCount}}">
															<div class="scrollit">
																<table class="friends">
																	<tr>
																		<th ng-repeat="sel in selecteds | limitTo: colCount" width="200">
																			<button ng-click="sortBy(keys[sel])">{{keys[sel]}}</button>
																			<span class="sortorder" ng-show="propertyName == keys[sel]" ng-class="{reverse: reverse}"></span>
																		</th>
																	</tr>
																	<tr ng-repeat="value in lignes | orderBy:propertyName:reverse | limitTo:display_limit1" ng-init="parentIndex = $index">
																		<td ng-repeat="sel in selecteds | limitTo: colCount" width="200">
																			{{getValues(keys[sel])[parentIndex]}}
																		</td>  
																	</tr>
																</table>
															</div>
														</td>
													</tr>
												</tbody>
												
												<!--
												<tbody>
													<tr>
														<td colspan="{{colCount}}">
															<div class="scrollit">
																<table>
																	<tr>
																		<th ng-repeat="sel in selecteds | limitTo: colCount" width="200">{{keys[sel]}}
																		<button ng-click="sortBy(propertyName)">{{keys[sel]}}</button>

																		</th>
																	</tr>
																	<tr ng-repeat="value in lignes | orderBy: propertyName :reverse |limitTo:display_limit1" ng-init="parentIndex = $index">
																		<td ng-repeat="sel in selecteds |  limitTo: colCount" width="200">
																			{{ getValues(keys[sel])[parentIndex] }}

																		</td>  
																	</tr>
																</table>
															</div>
														</td>
													</tr>
												</tbody>
												-->
										</table>
									</div>
								</div>
							</div>
	</body>
	
	<script>
	
	function myFunc() {
		
		console.log("Ajout du Widget");
	}
			
	</script>

</html>
