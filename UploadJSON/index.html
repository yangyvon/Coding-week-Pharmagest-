<!DOCTYPE html>
<html ng-app="TestUploadFile">

  <head>
    <!-- Encodage -->
	<meta charset="utf-8" />
	<!-- Feuille de style -->
	<link rel="stylesheet" type="text/css" href="styleDSQ.css">
	<!-- Bootstrap -->
    <link data-require="bootstrap-css@3.0.0-rc2" data-semver="3.0.0-rc2" rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap.min.css" />
    <!-- AngularJS -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>

	<script src="https://cdn.gitcdn.link/cdn/angular/bower-material/v1.1.5/angular-material.js"></script>
	
	<!--D3.JS-->
	<script src="https://d3js.org/d3.v4.min.js"></script>

    <title>PI Pharmagest</title>
    <script>document.write('<base href="' + document.location + '" />');</script>
    <link rel="stylesheet" href="styleDSQ.css" />
    <script data-require="angular.js@1.0.x" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js" data-semver="1.0.8"></script>
    <script> var app = angular.module('TestUploadFile', []);
    		 var app2 = angular.module('charts',['TestUploadFile']) </script>

    <script src="upload.js"></script>
    <script src="app.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type = "text/javascript">
         google.charts.load('current', {packages: ['corechart']});
    </script>
  </head>

<body>
 <!-- <div ng-controller="ImageUploadController ">
   <form>
        <input type="file" ng-file-select="onFileSelect($files)" >  
   </form>
   <b>Aperçu de l'image :</b><br />
   <i ng-hide="imageSrc">Aucune image sélectionnée</i>
   <img ng-src="{{imageSrc}}" /><br/>
   <b>Téléchargement de l'image :</b>
  <progress value="{{progress}}"></progress>
</div>
 -->

<!-- <div ng-controller="JsonController">
	<h1>Lecture d'un fichier Json</h1>
	<h2>Nombre total de personnes : {{ getTotalActeurs() }}</h2>
	<h3>Doc : {{getJson()}}</h3>
	<h4>Doc sous forme de liste : </h4>
	<ul>
        <li ng-repeat="acteur in acteurs">
          {{acteur}}
        </li>
    </ul>
    <div>Keys: 
			
			<ul>
				<li ng-repeat="key in keys">
					{{key}}
				</li>
			</ul>
	Values :

			<ul>
				<li ng-repeat="value in values">
					{{value}}
				</li>
			</ul>
		</div>
</div> 
 -->
 
<div ng-controller="JsonUploadController ">
	<h1>Upload du Json</h1>
	<form>
	    <input type="file" read-text="onFileSelect($files)" >
<!-- 	 <input type="file" ng-file-select="onFileSelect($files)" multiple>
 -->	</form>
	<b>Aperçu du json :</b><br />
	<i ng-hide="jsonSrc">Aucun json sélectionné</i>

	<div id="conteneur">
	<div ng-show="jsonSrc" class="col-md-6">
		<ul
				 ng-repeat="ligne in lignes">
					{{ligne}}
				
			</ul>

	</div>
	<div ng-show="jsonSrc" style class="col-md-6">

	Keys: 
			
			<ul>
				<li ng-repeat="key in keys">
					{{key}}
				</li>
			</ul>
	Values de la première ligne :

			<ul>
				<li ng-repeat="value in values">
					{{value}}
				</li>
			</ul>

	<div>
	Select X : 
			<select ng-model="selectedX">
				<option ng-repeat="key in keys" value="{{key}}">{{key}}</option>
			</select>
			
			<br><br>
			
			Selected X Attribute : {{selectedX}}
			<br>
			X values : {{getValues(selectedX)}}
			
			<br><br>
			
			Select Y : 
			<select ng-model="selectedY">
				<option ng-repeat="key2 in keys" value="{{key2}}">{{key2}}</option>
			</select>
			
			<br><br>
			
			Selected Y Attribute : {{selectedY}}
			<br>
			Y values : {{getValues(selectedY)}}
			
			<br><br>
	</div>
</div>
	<div ng-show ="jsonSrc" id= "chart_d3" style="width: 100%; height: 800px;">
		<style>

		.area {
		  fill: steelblue;
		  clip-path: url(#clip);
		}

		.zoom {
		  cursor: move;
		  fill: none;
		  pointer-events: all;
		}

		</style>
		<svg width="960" height="500"></svg>
		<script>

			var svg = d3.select("svg"),
			    margin = {top: 20, right: 20, bottom: 110, left: 40},
			    margin2 = {top: 430, right: 20, bottom: 30, left: 40},
			    width = +svg.attr("width") - margin.left - margin.right,
			    height = +svg.attr("height") - margin.top - margin.bottom,
			    height2 = +svg.attr("height") - margin2.top - margin2.bottom;

			var parseDate = d3.timeParse("%b %Y");
			var x = d3.scaleTime().range([0, width]),
			    x2 = d3.scaleTime().range([0, width]),
			    y = d3.scaleLinear().range([height, 0]),
			    y2 = d3.scaleLinear().range([height2, 0]);

			var xAxis = d3.axisBottom(x),
			    xAxis2 = d3.axisBottom(x2),
			    yAxis = d3.axisLeft(y);

			var brush = d3.brushX()
			    .extent([[0, 0], [width, height2]])
			    .on("brush end", brushed);

			var zoom = d3.zoom()
			    .scaleExtent([1, Infinity])
			    .translateExtent([[0, 0], [width, height]])
			    .extent([[0, 0], [width, height]])
			    .on("zoom", zoomed);

			var area = d3.area()
			    .curve(d3.curveMonotoneX)
			    .x(function(d) { return x(d.date); })
			    .y0(height)
			    .y1(function(d) { return y(d.price); });

			var area2 = d3.area()
			    .curve(d3.curveMonotoneX)
			    .x(function(d) { return x2(d.date); })
			    .y0(height2)
			    .y1(function(d) { return y2(d.price); });

			svg.append("defs").append("clipPath")
			    .attr("id", "clip")
			  .append("rect")
			    .attr("width", width)
			    .attr("height", height);

			var focus = svg.append("g")
			    .attr("class", "focus")
			    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			var context = svg.append("g")
			    .attr("class", "context")
			    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");


			d3.csv("sp500.csv", type, function(error, data) {
				  if (error) throw error;

				  x.domain(d3.extent(data, function(d) { return d.date; }));
				  y.domain([0, d3.max(data, function(d) { return d.price; })]);
				  x2.domain(x.domain());
				  y2.domain(y.domain());

				  focus.append("path")
				      .datum(data)
				      .attr("class", "area")
				      .attr("d", area);

				  focus.append("g")
				      .attr("class", "axis axis--x")
				      .attr("transform", "translate(0," + height + ")")
				      .call(xAxis);

				  focus.append("g")
				      .attr("class", "axis axis--y")
				      .call(yAxis);

				  context.append("path")
				      .datum(data)
				      .attr("class", "area")
				      .attr("d", area2);

				  context.append("g")
				      .attr("class", "axis axis--x")
				      .attr("transform", "translate(0," + height2 + ")")
				      .call(xAxis2);

				  context.append("g")
				      .attr("class", "brush")
				      .call(brush)
				      .call(brush.move, x.range());

				  svg.append("rect")
				      .attr("class", "zoom")
				      .attr("width", width)
				      .attr("height", height)
				      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				      .call(zoom);
				});

				function brushed() {
				  if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
				  var s = d3.event.selection || x2.range();
				  x.domain(s.map(x2.invert, x2));
				  focus.select(".area").attr("d", area);
				  focus.select(".axis--x").call(xAxis);
				  svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
				      .scale(width / (s[1] - s[0]))
				      .translate(-s[0], 0));
				}

				function zoomed() {
				  if (d3.event.sourceEvent && d3.event.sourceEvent.type === "brush") return; // ignore zoom-by-brush
				  var t = d3.event.transform;
				  x.domain(t.rescaleX(x2).domain());
				  focus.select(".area").attr("d", area);
				  focus.select(".axis--x").call(xAxis);
				  context.select(".brush").call(brush.move, x.range().map(t.invertX, t));
				}

				function type(d) {
				  d.date = parseDate(d.date);
				  d.price = +d.price;
				  return d;
				}
		</script>
	</div>

	<div ng-show="jsonSrc" id="chart_google" style="width: 100%; height: 800px;">
			    <script src="googleChart.js"></script>
	</div>

</div> 

</body>

</html>
